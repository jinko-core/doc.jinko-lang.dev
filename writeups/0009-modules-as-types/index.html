
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../0009-closures/">
      
      
        <link rel="next" href="../0010-first-class-types/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.19">
    
    
      
        <title>WU0009: Modules as types - jinko docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.66ac8b77.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#wu0009-modules-as-types" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="jinko docs" class="md-header__button md-logo" aria-label="jinko docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            jinko docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              WU0009: Modules as types
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="deep-purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="deep-purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/jinko-core/jinko" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="jinko docs" class="md-nav__button md-logo" aria-label="jinko docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    jinko docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/jinko-core/jinko" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jinko programming documentation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Language
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Language
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../language/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The jinko programming language
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../language/variables/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Variables
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Types
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Types
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../language/types/0_builtin_types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Built-in types
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../language/types/1_custom_types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom types in jinko
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../language/types/2_contract/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Type obligations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../language/types/multi_types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multi types
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Standard library
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Standard library
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../standard-library/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Writeups
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Writeups
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0000-design/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0000: Design
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0001-error-handling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0001: Error handling in jinko
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0002-generics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0002: Canonicalization and generics in jinko
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0003-multi-types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0003: Sum types in jinko
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0004-error-handling-inside-the-interpreter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0004: Error handling inside jinko's interpreter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0007-partial-application-op/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0007: Partial Application operator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0008-specialization-partial-generics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0008: Specialization, generic application, partial generic application
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0009-closures/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0009: Closures
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    WU0009: Modules as types
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    WU0009: Modules as types
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#existing-solution" class="md-nav__link">
    <span class="md-ellipsis">
      Existing solution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#problems" class="md-nav__link">
    <span class="md-ellipsis">
      Problems
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proposed-solution" class="md-nav__link">
    <span class="md-ellipsis">
      Proposed solution
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Proposed solution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bikeshedding" class="md-nav__link">
    <span class="md-ellipsis">
      Bikeshedding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issues" class="md-nav__link">
    <span class="md-ellipsis">
      Issues
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Issues">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-should-the-importing-machinery-work" class="md-nav__link">
    <span class="md-ellipsis">
      How should the "importing" machinery work?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requires-first-class-types" class="md-nav__link">
    <span class="md-ellipsis">
      Requires first class types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#first-solution-type-specialization-crimes" class="md-nav__link">
    <span class="md-ellipsis">
      First solution: Type specialization crimes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#second-solution-first-class-types" class="md-nav__link">
    <span class="md-ellipsis">
      Second solution: First class types
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#side-notes" class="md-nav__link">
    <span class="md-ellipsis">
      Side notes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Side notes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#type-type-information" class="md-nav__link">
    <span class="md-ellipsis">
      type type information
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-overriding" class="md-nav__link">
    <span class="md-ellipsis">
      Module overriding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ufcs-method-resolution" class="md-nav__link">
    <span class="md-ellipsis">
      UFCS method resolution
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0010-first-class-types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0010: First class types
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0011-shell-abstractions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0011: Shell abstraction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0012-default-field-access/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0012: Default field accesses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0013-kind-system/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0013: Kind system
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0014-type-system/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0014: Type system
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0015-ufcs-and-function-calls-rules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0015: UFCS and function resolution rules
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#existing-solution" class="md-nav__link">
    <span class="md-ellipsis">
      Existing solution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#problems" class="md-nav__link">
    <span class="md-ellipsis">
      Problems
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#proposed-solution" class="md-nav__link">
    <span class="md-ellipsis">
      Proposed solution
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Proposed solution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bikeshedding" class="md-nav__link">
    <span class="md-ellipsis">
      Bikeshedding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issues" class="md-nav__link">
    <span class="md-ellipsis">
      Issues
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Issues">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-should-the-importing-machinery-work" class="md-nav__link">
    <span class="md-ellipsis">
      How should the "importing" machinery work?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requires-first-class-types" class="md-nav__link">
    <span class="md-ellipsis">
      Requires first class types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#first-solution-type-specialization-crimes" class="md-nav__link">
    <span class="md-ellipsis">
      First solution: Type specialization crimes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#second-solution-first-class-types" class="md-nav__link">
    <span class="md-ellipsis">
      Second solution: First class types
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#side-notes" class="md-nav__link">
    <span class="md-ellipsis">
      Side notes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Side notes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#type-type-information" class="md-nav__link">
    <span class="md-ellipsis">
      type type information
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-overriding" class="md-nav__link">
    <span class="md-ellipsis">
      Module overriding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ufcs-method-resolution" class="md-nav__link">
    <span class="md-ellipsis">
      UFCS method resolution
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="wu0009-modules-as-types">WU0009: Modules as types</h1>
<p>This writeup explores the possibility of removing the <code>incl &lt;source&gt;</code> syntax for a more functional approach to "includes" or modules as a whole.</p>
<h2 id="existing-solution">Existing solution</h2>
<p>The include mechanism currently copies and paste source code in the current scope or in an inner scope. We need to figure out solutions around namespaces and module pathing to be able to use them properly, otherwise they are extremely annoying to use and prone to errors - with similar issues to C, where the lack of namespacing and copy-pasting of code is causing immense pain.</p>
<h2 id="problems">Problems</h2>
<ol>
<li>Lack of scoping at the time</li>
<li>Need special handling</li>
<li>Need special handling for inner functions/types</li>
<li>Need special path resolution - not present with regular <code>jinko</code> code</li>
</ol>
<h2 id="proposed-solution">Proposed solution</h2>
<p>Including a module creates a magical type, with fields corresponding to each item present in the module.</p>
<h3 id="bikeshedding">Bikeshedding</h3>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> <code>source</code></li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <code>mod</code></li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <code>module</code></li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <code>incl</code></li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <code>with</code></li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <code>import</code></li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <code>jk</code></li>
</ul>
<h3 id="issues">Issues</h3>
<h4 id="how-should-the-importing-machinery-work">How should the "importing" machinery work?</h4>
<p>Let's imagine the bikeshedding discussion is over and we have settled on <code>source</code> as the name of the function responsible for importing a module into the current scope.
The original plan was for the <code>source</code> function to have the following signature:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">func</span><span class="w"> </span><span class="n">source</span><span class="p">(</span><span class="n">path</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">type</span><span class="p">;</span>
</code></pre></div>
<p>This function would create a new, anonymous <code>type</code> and return it - it could then be aliased like so:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">type</span> <span class="nc">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span>
</code></pre></div>
<p>The issue with this is that we do not only want a type, but also an <em>instance</em> of that type: if the module foo defines a function <code>bar</code>, we want <code>foo.bar</code> to point to this specific function, not otherwise.
There are multiple solutions to this:</p>
<ol>
<li>Keep <code>source</code> as a function returning a <code>type</code></li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">func</span><span class="w"> </span><span class="n">source</span><span class="p">(</span><span class="n">path</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">type</span><span class="p">;</span>
</code></pre></div>
<ul>
<li>Instantiate the type upon receptioning it</li>
<li>The default parameters for each of the fields contain the proper module values, functions and types</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">type</span> <span class="nc">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="k">where</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">foo</span><span class="p">();</span><span class="w"> </span><span class="c1">// instantiation </span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="c1">// shorthand</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="k">where</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">)();</span>
</code></pre></div>
<p>This opens up some possibilities such as specifying a module's function without changing the module or the code refering to it, as long as they are the exact same types? Is that something we want?</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1">// foo.jk</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="n">func</span><span class="w"> </span><span class="n">bar</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">int</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="c1">// main.jk</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="n">func</span><span class="w"> </span><span class="n">my_bar</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">int</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">16</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="k">where</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">)(</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">    </span><span class="n">bar</span>: <span class="nc">my_bar</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="p">);</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="n">foo</span><span class="p">.</span><span class="n">bar</span><span class="p">()</span><span class="w"> </span><span class="c1">// returns 16</span>
</code></pre></div>
<p>However, the syntax is unwieldy - should we offer a shorthand so that <code>TypeName;</code> and <code>TypeName();</code> are similar in the case where <code>TypeName</code> contains default values for all of its fields?</p>
<p>This would allow the following:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">where</span><span class="w"> </span><span class="n">foo_base</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="k">where</span><span class="w"> </span><span class="n">foo_overriden</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">)(</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">    </span><span class="n">bar</span>: <span class="nc">my_bar</span><span class="p">,</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="p">);</span>
</code></pre></div>
<ol>
<li>Have <code>source</code> be generic and return an instance of its type parameter</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">func</span><span class="w"> </span><span class="n">source</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">path</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">T</span><span class="p">;</span>
</code></pre></div>
<ul>
<li>The magical type generated is now fully opaque and cannot be aliased, or not trivially at least</li>
<li>No module overriding (but do we want this in the first place)</li>
<li>Simpler syntax</li>
<li>
<p>Issues with external users specializing the <code>source</code> function? </p>
</li>
<li>
<p>Have <code>source</code> be a type, which offers specializations for each module</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">type</span> <span class="nc">source</span><span class="p">[</span><span class="n">T</span><span class="p">];</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="k">type</span> <span class="nc">source</span><span class="p">[</span><span class="n">T</span>: <span class="s">&quot;foo&quot;</span><span class="p">](</span><span class="n">bar</span>: <span class="nc">func</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">int</span><span class="p">);</span><span class="w"> </span><span class="c1">// magic generated by the compiler</span>
</code></pre></div>
<ul>
<li>Same issue as 1</li>
<li>Also requires the shorthand initialization for record types with defaults everywhere to be wieldy.</li>
</ul>
<p>Solution 1 with the type initialization shorthand has the cleanest syntax while offering module item overriding, which might be something interesting. If we do not want that, then solution 1 remains the clearest IMO.</p>
<p>Since we have UFCS, it also means that this syntax will be valid:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">type</span> <span class="nc">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;foo&quot;</span><span class="p">.</span><span class="n">source</span><span class="p">();</span>
</code></pre></div>
<p>Having the <code>source</code> mechanism be a function also allows extra optional parameters, such as the path of the file to source:</p>
<p>In Rust:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="cp">#[path = </span><span class="s">&quot;utils/bar.jk&quot;</span><span class="cp">]</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="k">mod</span> <span class="nn">foo</span><span class="p">;</span>
</code></pre></div>
<p>becomes</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">type</span> <span class="nc">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;utils/bar.jk&quot;</span><span class="p">);</span>
</code></pre></div>
<h4 id="requires-first-class-types">Requires first class types</h4>
<p>Let's say that we want to source the following <code>utils</code> module:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1">// foo.jk</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="k">type</span> <span class="nc">Left</span><span class="p">[</span><span class="n">L</span><span class="p">](</span><span class="n">inner</span>: <span class="nc">L</span><span class="p">);</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="k">type</span> <span class="nc">Right</span><span class="p">[</span><span class="n">R</span><span class="p">](</span><span class="n">inner</span>: <span class="nc">R</span><span class="p">);</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="k">type</span> <span class="nc">Either</span><span class="p">[</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Left</span><span class="p">[</span><span class="n">L</span><span class="p">]</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Right</span><span class="p">[</span><span class="n">R</span><span class="p">];</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="n">func</span><span class="w"> </span><span class="n">is_left</span><span class="p">[</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">](</span><span class="n">value</span>: <span class="nc">Either</span><span class="p">[</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">])</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">    </span><span class="n">switch</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">        </span><span class="n">_</span>: <span class="nc">Left</span><span class="w"> </span>-&gt; <span class="nc">true</span><span class="p">,</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">        </span><span class="n">_</span><span class="w"> </span>-&gt; <span class="nc">false</span><span class="p">,</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="p">}</span>
</code></pre></div>
<p>Accessing the <code>is_left</code> function with the proposed solution is quite easy - our magic type will have an <code>is_left</code> member of type <code>func[L, R](Either[L, R]) -&gt; bool</code>;
But how do we actually access the <code>Either</code> type? <code>utils.Either</code> would be nice, but it does mean that the generated <code>utils</code> type needs a field named <code>Either</code> which would be of type... <code>type</code>?</p>
<h4 id="first-solution-type-specialization-crimes">First solution: Type specialization crimes</h4>
<ol>
<li>Add type specialization</li>
<li>Generate a basic <code>util[T = ()]</code>  type which contains all of the members of our module <em>except</em> for the types.</li>
<li>Specialize <code>util</code> as each type within the module, so something like this</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">where</span><span class="w"> </span><span class="n">utils</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">(</span><span class="s">&quot;utils&quot;</span><span class="p">);</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="c1">// becomes</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="k">type</span> <span class="nc">utils</span><span class="p">[</span><span class="n">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()](</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">    </span><span class="n">is_left</span>: <span class="nc">func</span><span class="p">[</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">](</span><span class="n">Either</span><span class="p">[</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">])</span><span class="w"> </span>-&gt; <span class="kt">bool</span><span class="p">,</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="p">)</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="k">type</span> <span class="nc">utils</span><span class="p">[</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">T</span>: <span class="nc">Left</span><span class="p">](</span><span class="n">inner</span>: <span class="nc">L</span><span class="p">);</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="k">type</span> <span class="nc">utils</span><span class="p">[</span><span class="n">R</span><span class="p">,</span><span class="w"> </span><span class="n">T</span>: <span class="nc">Right</span><span class="p">](</span><span class="n">inner</span>: <span class="nc">R</span><span class="p">);</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="k">type</span> <span class="nc">utils</span><span class="p">[</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">,</span><span class="w"> </span><span class="n">T</span>: <span class="nc">Either</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utils</span><span class="p">[</span><span class="n">Left</span><span class="p">][</span><span class="n">L</span><span class="p">]</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">utils</span><span class="p">[</span><span class="n">Right</span><span class="p">][</span><span class="n">R</span><span class="p">];</span>
</code></pre></div>
<p>which we can use like so:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1">// main.jk</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="k">where</span><span class="w"> </span><span class="n">value</span>: <span class="nc">utils</span><span class="p">[</span><span class="n">Either</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utils</span><span class="p">[</span><span class="n">Left</span><span class="p">](</span><span class="n">inner</span>: <span class="mi">156</span><span class="p">);</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="n">utils</span><span class="p">.</span><span class="n">is_left</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
</code></pre></div>
<ul>
<li>Problems with this solution<ul>
<li>Different syntax from module functions and module variables</li>
<li>Unwieldy</li>
<li>Ugly as sin</li>
<li>Requires type specialization - do we want that?</li>
</ul>
</li>
</ul>
<p>Really not a fan of this solution</p>
<h4 id="second-solution-first-class-types">Second solution: First class types</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">where</span><span class="w"> </span><span class="n">utils</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">(</span><span class="s">&quot;utils&quot;</span><span class="p">);</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="c1">// becomes</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="k">type</span> <span class="nc">utils</span><span class="p">(</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">    </span><span class="n">Left</span>: <span class="nc">type</span><span class="p">,</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w">    </span><span class="n">Right</span>: <span class="nc">type</span><span class="p">,</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w">    </span><span class="n">Either</span>: <span class="nc">type</span><span class="p">,</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">    </span><span class="n">is_left</span>: <span class="nc">func</span><span class="p">[</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">](</span><span class="n">utils</span><span class="p">.</span><span class="n">Either</span><span class="p">[</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">])</span><span class="w"> </span>-&gt; <span class="kt">bool</span><span class="p">,</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="p">);</span>
</code></pre></div>
<p>which we can use like so:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1">// main.jk</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="k">where</span><span class="w"> </span><span class="n">value</span>: <span class="nc">utils</span><span class="p">.</span><span class="n">Either</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utils</span><span class="p">.</span><span class="n">Left</span><span class="p">(</span><span class="n">inner</span>: <span class="mi">156</span><span class="p">);</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="n">utils</span><span class="p">.</span><span class="n">is_left</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
</code></pre></div>
<ul>
<li>Problems with this solution<ul>
<li>Requires self referential types (<code>utils.is_left</code> is of type <code>func[L, R](utils.Either[L, R]) -&gt; bool</code>)</li>
<li>Requires first class type support</li>
<li>How to instantiate a <code>utils.Either</code> when we only know it's a type and not more?<ul>
<li>Runtime type information?</li>
<li>How to compile that?</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="side-notes">Side notes</h2>
<h3 id="type-type-information"><code>type</code> type information</h3>
<p>Sidenote: <code>type</code> types should probably have way more information, similarly to <code>func</code> types:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">type</span> <span class="nc">utils</span><span class="p">(</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">    </span><span class="n">Left</span>: <span class="nc">type</span><span class="p">[</span><span class="n">L</span><span class="p">](</span><span class="n">L</span><span class="p">),</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">    </span><span class="n">Right</span>: <span class="nc">type</span><span class="p">[</span><span class="n">R</span><span class="p">](</span><span class="n">R</span><span class="p">),</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">    </span><span class="n">Either</span>: <span class="nc">type</span><span class="p">[</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">](</span><span class="n">utils</span><span class="p">.</span><span class="n">Left</span><span class="p">[</span><span class="n">L</span><span class="p">]</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">utils</span><span class="p">.</span><span class="n">Right</span><span class="p">[</span><span class="n">R</span><span class="p">]),</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">    </span><span class="n">is_left</span>: <span class="nc">func</span><span class="p">[</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">](</span><span class="n">utils</span><span class="p">.</span><span class="n">Either</span><span class="p">[</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">])</span><span class="w"> </span>-&gt; <span class="kt">bool</span><span class="p">,</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="p">);</span>
</code></pre></div>
<h3 id="module-overriding">Module overriding</h3>
<p>How to propagate the changes to the rest of the instance if we do override a type's default parameter? Taking the above example, what should happen in this case?</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="k">type</span> <span class="nc">MyEither</span><span class="p">[</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">](</span><span class="n">inner</span>: <span class="nc">L</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">R</span><span class="p">);</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="k">where</span><span class="w"> </span><span class="n">utils</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">(</span><span class="s">&quot;utils&quot;</span><span class="p">)(</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">    </span><span class="n">Either</span>: <span class="nc">MyEither</span><span class="p">,</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="p">);</span>
</code></pre></div>
<p>This won't work, because the <code>Either</code> field is of type <code>type[L, R](utils.Left[L] | utils.Right[R])</code> - so since <code>MyEither</code> does not have the proper field types, it fails to typecheck.
So it'll work only if we redefine <code>Left</code> and <code>Right</code> as well.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="k">type</span> <span class="nc">MyL</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">T</span><span class="p">);</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="k">type</span> <span class="nc">MyR</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">T</span><span class="p">);</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="k">type</span> <span class="nc">MyEither</span><span class="p">[</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">](</span><span class="n">inner</span>: <span class="nc">MyL</span><span class="p">[</span><span class="n">L</span><span class="p">]</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">MyR</span><span class="p">[</span><span class="n">R</span><span class="p">]);</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="k">where</span><span class="w"> </span><span class="n">utils</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">(</span><span class="s">&quot;utils&quot;</span><span class="p">)(</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">    </span><span class="n">Left</span>: <span class="nc">MyL</span><span class="p">,</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">    </span><span class="n">Right</span>: <span class="nc">MyR</span><span class="p">,</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">    </span><span class="n">Either</span>: <span class="nc">MyEither</span><span class="p">,</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="p">);</span>
</code></pre></div>
<p>I'm thinking that this mostly would be useful for functions, or for some niche optimizations?</p>
<ol>
<li>Functions</li>
</ol>
<p>Let's say you'd like to add logging to the standard's library hashmap because you want to understand exactly how your values are being inserted in your map</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="k">where</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">(</span><span class="s">&quot;map&quot;</span><span class="p">)(</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">    </span><span class="n">insert</span>: <span class="nc">insert_with_log</span><span class="p">,</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="p">);</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="n">func</span><span class="w"> </span><span class="n">insert_with_log</span><span class="p">[</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="p">](</span><span class="n">map</span>: <span class="nc">HashMap</span><span class="p">[</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="p">],</span><span class="w"> </span><span class="n">key</span>: <span class="nc">K</span><span class="p">,</span><span class="w"> </span><span class="n">value</span>: <span class="nc">V</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">HashMap</span><span class="p">[</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">    </span><span class="c1">// memoized so it&#39;s not too costly</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">original_map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">(</span><span class="s">&quot;map&quot;</span><span class="p">);</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;inserting key {key} with value {value} into the map!&quot;</span><span class="p">);</span>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="w">    </span><span class="n">original_map</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">map</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="p">}</span>
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="k">where</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HashMap</span><span class="p">;</span>
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="k">where</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&quot;key&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;value&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// calls `insert_with_log`</span>
</code></pre></div>
<ol>
<li>Niche optimizations</li>
</ol>
<p>If you know that you will be using a small hashmap for example, you might want to override the map's module <code>Vector</code> type to use a <code>SmallVec</code> kind of implementation</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="k">type</span> <span class="nc">SmolVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">(</span><span class="s">&quot;small_vec&quot;</span><span class="p">).</span><span class="n">SmallVec</span><span class="p">;</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="k">where</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">(</span><span class="s">&quot;map&quot;</span><span class="p">)(</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="w">    </span><span class="n">Vector</span>: <span class="nc">SmolVector</span><span class="p">,</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="p">);</span>
</code></pre></div>
<p>This syntax needs a loooot of bikeshedding however. This is not pretty.</p>
<h3 id="ufcs-method-resolution">UFCS method resolution</h3>
<p>How to decide what function <code>12.foo()</code> should resolve to if <code>foo</code> was imported from a module?</p>
<ol>
<li>Enforce function reexporting</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">where</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">);</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="k">where</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">module</span><span class="p">.</span><span class="n">foo</span><span class="p">;</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="mf">12.</span><span class="n">foo</span><span class="p">();</span><span class="w"> </span><span class="c1">// resolves to foo -&gt; resolves to module.foo</span>
</code></pre></div>
<ol>
<li>Look through the fields of variables in scope for a matching signature?</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="k">where</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">);</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="mf">12.</span><span class="n">foo</span><span class="p">();</span><span class="w"> </span><span class="c1">// resolves to module.foo</span>
</code></pre></div>
<ul>
<li>Isn't that super unexpected as a behavior?</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="k">type</span> <span class="nc">SomeOtherType</span><span class="p">(</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">    </span><span class="n">foo</span>: <span class="nc">func</span><span class="p">(</span><span class="n">int</span><span class="p">),</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="p">);</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="n">func</span><span class="w"> </span><span class="n">my_foo</span><span class="p">(</span><span class="n">a</span>: <span class="nc">int</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="k">where</span><span class="w"> </span><span class="n">some_other_thing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SomeOtherType</span><span class="p">(</span><span class="n">foo</span>: <span class="nc">my_foo</span><span class="p">);</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="k">where</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">);</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="mf">12.</span><span class="n">foo</span><span class="p">();</span><span class="w"> </span><span class="c1">// resolves to module.foo OR some_other_thing.foo</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="c1">// ambiguity? weird error reporting?</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.dd8806f2.min.js"></script>
      
    
  </body>
</html>