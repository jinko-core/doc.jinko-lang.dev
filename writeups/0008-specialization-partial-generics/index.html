
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../0007-partial-application-op/">
      
      
        <link rel="next" href="../0009-closures/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.19">
    
    
      
        <title>WU0008: Specialization, generic application, partial generic application - jinko docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.66ac8b77.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#wu0008-specialization-generic-application-partial-generic-application" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="jinko docs" class="md-header__button md-logo" aria-label="jinko docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            jinko docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              WU0008: Specialization, generic application, partial generic application
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="deep-purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="deep-purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/jinko-core/jinko" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="jinko docs" class="md-nav__button md-logo" aria-label="jinko docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    jinko docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/jinko-core/jinko" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jinko programming documentation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Language
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Language
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../language/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The jinko programming language
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../language/variables/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Variables
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Types
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Types
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../language/types/0_builtin_types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Built-in types
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../language/types/1_custom_types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom types in jinko
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../language/types/2_contract/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Type obligations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../language/types/multi_types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multi types
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Standard library
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Standard library
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../standard-library/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Writeups
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Writeups
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0000-design/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0000: Design
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0001-error-handling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0001: Error handling in jinko
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0002-generics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0002: Canonicalization and generics in jinko
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0003-multi-types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0003: Sum types in jinko
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0004-error-handling-inside-the-interpreter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0004: Error handling inside jinko's interpreter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0007-partial-application-op/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0007: Partial Application operator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    WU0008: Specialization, generic application, partial generic application
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    WU0008: Specialization, generic application, partial generic application
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#specializing-functions-only-in-the-current-context" class="md-nav__link">
    <span class="md-ellipsis">
      Specializing functions only in the current context
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#specialization-as-pattern-matching-extension" class="md-nav__link">
    <span class="md-ellipsis">
      Specialization as pattern matching extension?
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0009-closures/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0009: Closures
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0009-modules-as-types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0009: Modules as types
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0010-first-class-types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0010: First class types
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0011-shell-abstractions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0011: Shell abstraction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0012-default-field-access/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0012: Default field accesses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0013-kind-system/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0013: Kind system
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0014-type-system/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0014: Type system
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0015-ufcs-and-function-calls-rules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WU0015: UFCS and function resolution rules
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#specializing-functions-only-in-the-current-context" class="md-nav__link">
    <span class="md-ellipsis">
      Specializing functions only in the current context
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#specialization-as-pattern-matching-extension" class="md-nav__link">
    <span class="md-ellipsis">
      Specialization as pattern matching extension?
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="wu0008-specialization-generic-application-partial-generic-application">WU0008: Specialization, generic application, partial generic application</h1>
<p>Let's consider <code>jinko</code>'s memory release mechanism. If the goal is to make copies explicit and moves implicit, one can explicitly ask for a value to be released (and for its memory to be released by the garbage collector)
using a simple moving function such as this one;</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">type</span> <span class="nc">MegaBigDynamicStruct</span><span class="p">(</span><span class="n">a</span>: <span class="nc">Vector</span><span class="p">[</span><span class="n">Vector</span><span class="p">[</span><span class="n">string</span><span class="p">]]</span><span class="w"> </span><span class="cm">/* wahou! */</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="n">func</span><span class="w"> </span><span class="n">consume</span><span class="p">(</span><span class="n">value</span>: <span class="nc">MegaBigDynamicStruct</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="k">where</span><span class="w"> </span><span class="n">mbds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MegaBigDynamicStruct</span><span class="p">(</span><span class="n">a</span>: <span class="nc">Vector</span>::<span class="n">new</span><span class="p">().</span><span class="n">append</span><span class="p">(</span><span class="n">Vector</span>::<span class="n">new</span><span class="p">().</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;so dynamic!&quot;</span><span class="p">))));</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="n">mbds</span><span class="p">.</span><span class="n">consume</span><span class="p">();</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="c1">// error: use of moved value mbds</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="k">where</span><span class="w"> </span><span class="n">first_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mbds</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</code></pre></div>
<p>We can generalize this mechanism and offer a generic <code>consume</code> function. Since the garbage collector is not guaranteed to run immediately, it's more like you're marking a value for release rather than releasing it. Let's call
this function <code>rot</code>, as you're indicating that you're leaving this value to decay and won't be using it anymore.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">func</span><span class="w"> </span><span class="n">rot</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">value</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>
<p>...and that's it! We now have a generic function which takes care of indicating to the GC that this value's memory can be reclaimed. We can imagine something like this for <code>jinko</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">func</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Baz</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bar</span><span class="p">();</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">baz</span><span class="p">();</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="s">&quot;{a}&quot;</span><span class="p">);</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">    </span><span class="n">b</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="p">}</span>
</code></pre></div>
<p>One pass the interpreter should have should be to insert calls to <code>rot</code> when possible, in order to reclaim memory. Because in this function <code>foo</code>, <code>a</code> goes out of scope at the end and is not used or returned afterwards like <code>b</code>,
we can imagine the following code after said "rot-pass", after the last uses of <code>a</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">func</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Baz</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bar</span><span class="p">();</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">baz</span><span class="p">();</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="s">&quot;{a}&quot;</span><span class="p">);</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="n">rot</span><span class="p">();</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">    </span><span class="n">b</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="p">}</span>
</code></pre></div>
<p>Now, this is all good and dandy, but we can extend this <code>rot</code> mechanism to incur interesting behavior on memory release. For example, a type which takes care of managing an operating system resource, like a file descriptor or
dynamic memory.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">ext</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="n">path</span>: <span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="n">flags</span>: <span class="nc">int</span><span class="p">);</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="n">ext</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="n">read</span><span class="p">(</span><span class="n">path</span>: <span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="n">flags</span>: <span class="nc">int</span><span class="p">);</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="k">type</span> <span class="nc">Error</span><span class="p">(</span><span class="n">cause</span>: <span class="nc">string</span><span class="p">);</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="k">type</span> <span class="nc">File</span><span class="p">(</span><span class="n">path</span>: <span class="nc">string</span><span class="p">,</span><span class="w"> </span><span class="n">fd</span>: <span class="nc">Maybe</span><span class="p">[</span><span class="n">int</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Nothing</span><span class="p">);</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="n">func</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="n">f</span>: <span class="nc">File</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="p">[</span><span class="n">File</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">    </span><span class="n">switch</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">fd</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">        </span><span class="n">fd</span>: <span class="nc">int</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Error</span><span class="p">(</span><span class="n">cause</span>: <span class="s">&quot;file {f.path} is already opened&quot;</span><span class="p">),</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">        </span><span class="n">_</span>: <span class="nc">Nothing</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">            </span><span class="k">where</span><span class="w"> </span><span class="n">new_fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">new_fd</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">                </span><span class="n">Error</span><span class="p">(</span><span class="n">cause</span>: <span class="s">&quot;couldn&#39;t open file&quot;</span><span class="p">)</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">                </span><span class="n">File</span><span class="p">(</span><span class="n">path</span>: <span class="nc">fd</span><span class="p">.</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">fd</span>: <span class="nc">new_fd</span><span class="p">)</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="p">}</span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="n">func</span><span class="w"> </span><span class="n">read</span><span class="p">(</span><span class="n">f</span>: <span class="nc">File</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="p">[</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">Error</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="w">    </span><span class="n">switch</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">fd</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="w">        </span><span class="n">fd</span>: <span class="nc">int</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="w">            </span><span class="k">where</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="w">            </span><span class="k">where</span><span class="w"> </span><span class="n">ret_val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">.</span><span class="n">ref_mut</span><span class="p">(),</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="w">            </span><span class="n">buf</span>
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="w">        </span><span class="n">_</span>: <span class="nc">Nothing</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">open</span><span class="p">().</span><span class="kr">try</span><span class="p">().</span><span class="n">read</span><span class="p">(),</span>
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="p">}</span>
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a>
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="n">func</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">test_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="s">&quot;test.jk&quot;</span><span class="p">);</span>
<a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a>
<a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a><span class="w">    </span><span class="c1">// here, the interpreter will insert a call to test_file.rot()</span>
<a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a><span class="p">}</span>
</code></pre></div>
<p>when <code>test_file</code> goes out of scope here, it would be nice for the underlying file descriptor to get closed. This way, we can return the resource to the OS and avoid leaking resources. One way to do so would be to <em>specialize</em> the behavior of <code>rot</code> for <code>File</code> instances,
so that it performs a call to <code>close</code>. Let's explore the various syntaxes to achieve this.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">ext</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="n">close</span><span class="p">(</span><span class="n">fd</span>: <span class="nc">int</span><span class="p">);</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="n">func</span><span class="w"> </span><span class="n">close</span><span class="p">(</span><span class="n">f</span>: <span class="nc">File</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">    </span><span class="n">switch</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">fd</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">        </span><span class="n">fd</span>: <span class="nc">int</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">),</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">        </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="p">}</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="c1">// specialize the rot function for `File`</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="n">func</span><span class="w"> </span><span class="n">rot</span><span class="p">[</span><span class="o">???</span><span class="p">](</span><span class="n">f</span>: <span class="nc">File</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">    </span><span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="p">}</span>
</code></pre></div>
<p>How would the syntax for specifying the generic type <code>T</code> to be <code>File</code> look like?</p>
<p>One proposal is as follows
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">func</span><span class="w"> </span><span class="n">rot</span><span class="p">[</span><span class="n">T</span>: <span class="nc">File</span><span class="p">](</span><span class="n">f</span>: <span class="nc">File</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">    </span><span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="p">}</span>
</code></pre></div></p>
<p>This syntax is nice, but does not really allow partial specialization. We could want something like this <code>rot</code> function for vectors or tuples
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">func</span><span class="w"> </span><span class="n">rot</span><span class="p">[</span><span class="n">T</span>: <span class="nc">Vector</span><span class="p">[</span><span class="n">T</span><span class="p">]](</span><span class="n">v</span>: <span class="nc">Vector</span><span class="p">[</span><span class="n">T</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">        </span><span class="n">value</span><span class="p">.</span><span class="n">rot</span><span class="p">()</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="p">}</span>
</code></pre></div></p>
<p>Having an implicit rule for reusing the same generics does not work really well and could get confusing
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1">// what is the difference between</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="n">func</span><span class="w"> </span><span class="n">rot</span><span class="p">[</span><span class="n">T</span>: <span class="nc">Vector</span><span class="p">[</span><span class="n">T</span><span class="p">]](</span><span class="n">v</span>: <span class="nc">Vector</span><span class="p">[</span><span class="n">T</span><span class="p">]);</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="c1">// and</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="n">func</span><span class="w"> </span><span class="n">rot</span><span class="p">[</span><span class="n">T</span>: <span class="nc">Vector</span><span class="p">[</span><span class="n">int</span><span class="p">]](</span><span class="n">v</span>: <span class="nc">Vector</span><span class="p">[</span><span class="n">int</span><span class="p">]);</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="c1">// and</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="n">func</span><span class="w"> </span><span class="n">rot</span><span class="p">[</span><span class="n">T</span>: <span class="nc">Vector</span><span class="p">[</span><span class="n">undeclared_type</span><span class="p">]](</span><span class="n">v</span>: <span class="nc">Vector</span><span class="p">[</span><span class="n">undeclared_type</span><span class="p">]);</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="c1">// which one should error out?</span>
</code></pre></div></p>
<p>Where is the type <code>T</code> used within <code>Vector[T]</code> defined? Is that a type error because <code>Vector[T]</code> refers to a type <code>T</code> which is undefined? Should the syntax be something like this to explicitly declare the second generic?
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">func</span><span class="w"> </span><span class="n">rot</span><span class="p">[</span><span class="n">U</span><span class="p">][</span><span class="n">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector</span><span class="p">[</span><span class="n">U</span><span class="p">]](</span><span class="n">v</span>: <span class="nc">Vector</span><span class="p">[</span><span class="n">U</span><span class="p">]);</span><span class="w"> </span><span class="c1">// ?</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">func</span><span class="w"> </span><span class="n">rot</span><span class="p">[</span><span class="n">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector</span><span class="p">[</span><span class="n">U</span><span class="p">]](</span><span class="n">v</span>: <span class="nc">Vector</span><span class="p">[</span><span class="n">U</span><span class="p">])[</span><span class="n">U</span><span class="p">];</span><span class="w"> </span><span class="c1">// ?</span>
</code></pre></div></p>
<p>This is basically a partial application of generics. If we solve that syntax issue, we can probably reuse the same syntax for partial function application.</p>
<p>The philosophy of generics is that they are usually declared before being used, for example in the case of the generic <code>rot</code> or <code>id</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1">// declared here...</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="c1">//       |</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="c1">//       |   and used here</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="c1">//       |        |     |</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="c1">//       v        v     v</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="n">func</span><span class="w"> </span><span class="n">id</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">value</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">T</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">    </span><span class="n">value</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="p">}</span>
</code></pre></div>
<p>For application however, the specialized type comes after the function or type being used:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">type</span> <span class="nc">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">value</span>: <span class="nc">T</span><span class="p">);</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="c1">//      generic applied here</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="c1">//                vvv</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="k">where</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Generic</span><span class="p">[</span><span class="n">int</span><span class="p">](</span><span class="mi">15</span><span class="p">);</span>
</code></pre></div>
<p>so one could think of specialization as generic application, but on a function declaration instead of type
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">func</span><span class="w"> </span><span class="n">rot</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">value</span>: <span class="nc">T</span><span class="p">)[</span><span class="n">File</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">    </span><span class="c1">// value is a `File`</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="p">}</span>
</code></pre></div></p>
<p>but what about the following examples?
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1">// is that an error?</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="n">func</span><span class="w"> </span><span class="n">rot</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">value</span>: <span class="nc">File</span><span class="p">)[</span><span class="n">File</span><span class="p">]</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="c1">// where is `T` from `Vec[T]` defined?</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="n">func</span><span class="w"> </span><span class="n">rot</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">value</span>: <span class="nc">T</span><span class="p">)[</span><span class="n">Vector</span><span class="p">[</span><span class="n">T</span><span class="p">]]</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="c1">// is this better? where is `U` defined?</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="n">func</span><span class="w"> </span><span class="n">rot</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">value</span>: <span class="nc">T</span><span class="p">)[</span><span class="n">Vector</span><span class="p">[</span><span class="n">U</span><span class="p">]]</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="c1">// what&#39;s the difference with this?</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="n">func</span><span class="w"> </span><span class="n">rot</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">value</span>: <span class="nc">T</span><span class="p">)[</span><span class="n">Vector</span><span class="p">[</span><span class="n">undeclared_type</span><span class="p">]]</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="n">func</span><span class="w"> </span><span class="n">rot</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">value</span>: <span class="nc">T</span><span class="p">)[</span><span class="n">Vector</span><span class="p">[</span><span class="n">int</span><span class="p">]]</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div></p>
<p>Or we could have entirely different partial function specialization syntax, which could mean "returns a function specializable on a generic <code>U</code>"</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">func</span><span class="w"> </span><span class="n">rot</span><span class="p">[</span><span class="n">T</span>: <span class="nb">Vec</span><span class="p">[</span><span class="n">U</span><span class="p">]](</span><span class="n">value</span>: <span class="nb">Vec</span><span class="p">[</span><span class="n">U</span><span class="p">])</span>: <span class="p">[</span><span class="n">U</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="p">}</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="c1">// gets a bit uglier here...</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="n">func</span><span class="w"> </span><span class="n">id</span><span class="p">[</span><span class="n">T</span>: <span class="nc">Vector</span><span class="p">[</span><span class="n">U</span><span class="p">]](</span><span class="n">value</span>: <span class="nc">Vector</span><span class="p">[</span><span class="n">U</span><span class="p">])</span>: <span class="p">[</span><span class="n">U</span><span class="p">]</span><span class="w"> </span>-&gt; <span class="nc">Vector</span><span class="p">[</span><span class="n">U</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w">    </span><span class="n">value</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="p">}</span>
</code></pre></div>
<p>or even forego the concept entirely, define each function as a generic type (a callable one), and specialize by defining new bindings</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">func</span><span class="w"> </span><span class="n">rot</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">value</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="k">where</span><span class="w"> </span><span class="n">rot</span><span class="p">[</span><span class="n">f</span>: <span class="nc">File</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">    </span><span class="n">f</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="p">}</span>
</code></pre></div>
<p>or remove the generics entirely, keeping them only in the case of partial specialization?</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">func</span><span class="w"> </span><span class="n">rot</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">value</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="n">func</span><span class="w"> </span><span class="n">rot</span><span class="p">(</span><span class="n">value</span>: <span class="nc">File</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="n">close</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="n">func</span><span class="w"> </span><span class="n">rot</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">values</span>: <span class="nc">Vector</span><span class="p">[</span><span class="n">T</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="n">rot</span><span class="p">()</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
and have error about "useless" specialization? As in, show as duplicate functions?
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1">// function already declared here - might be a useless case of specialization?</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="n">func</span><span class="w"> </span><span class="n">rot</span><span class="p">[</span><span class="n">U</span><span class="p">](</span><span class="n">value</span>: <span class="nc">U</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="c1">// consider restricting the type `U` further for partial specialization</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="c1">// func rot[U](value: ...[U]) {}</span>
</code></pre></div></p>
<p>which is probably the better solution :)</p>
<p>Alternatively, we can also keep generics and add new generics to partially specialized functions:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">func</span><span class="w"> </span><span class="n">rot</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">value</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="n">func</span><span class="w"> </span><span class="n">rot</span><span class="p">[</span><span class="n">T</span>: <span class="nc">File</span><span class="p">](</span><span class="n">value</span>: <span class="nc">File</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="n">close</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="n">func</span><span class="w"> </span><span class="n">rot</span><span class="p">[</span><span class="n">I</span><span class="p">,</span><span class="w"> </span><span class="n">T</span>: <span class="nc">Vector</span><span class="p">[</span><span class="n">I</span><span class="p">]](</span><span class="n">value</span>: <span class="nc">Vector</span><span class="p">[</span><span class="n">I</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="n">rot</span><span class="p">()</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>Let's take a look at a few examples where partial generic application and specialization become useful:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1">// declaration without a body - there&#39;s no &quot;generic&quot; way to format something and it should be an error</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="n">func</span><span class="w"> </span><span class="n">format</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">value</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="p">;</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="c1">// specialization for the primitive types</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="n">func</span><span class="w"> </span><span class="n">format</span><span class="p">[</span><span class="n">T</span>: <span class="nc">int</span><span class="p">](</span><span class="n">value</span>: <span class="nc">int</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">    </span><span class="n">format_int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="p">}</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="n">func</span><span class="w"> </span><span class="n">format</span><span class="p">[</span><span class="n">T</span>: <span class="kt">bool</span><span class="p">](</span><span class="n">value</span>: <span class="kt">bool</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="w">    </span><span class="n">switch</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="w">        </span><span class="kc">true</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="p">,</span>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="w">        </span><span class="kc">false</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="p">,</span>
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="p">}</span>
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a>
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="n">func</span><span class="w"> </span><span class="n">format</span><span class="p">[</span><span class="n">T</span>: <span class="kt">char</span><span class="p">](</span><span class="n">value</span>: <span class="kt">char</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="w">    </span><span class="s">&quot;&quot;</span><span class="p">.</span><span class="n">concat</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="p">}</span>
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a>
<a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a><span class="n">func</span><span class="w"> </span><span class="n">format</span><span class="p">[</span><span class="n">T</span>: <span class="nc">string</span><span class="p">](</span><span class="n">value</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a><span class="w">    </span><span class="n">value</span>
<a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a><span class="p">}</span>
</code></pre></div>
<p>If we omit the binding syntax (<code>T: whatever</code>), the one thing sticking out to me is that the specialized versions of <code>format</code> look just like regular functions. There is no indication (syntactically) that they are specialized functions. So for example why would this
error out</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">func</span><span class="w"> </span><span class="n">not_spec</span><span class="p">(</span><span class="n">a</span>: <span class="nc">int</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">int</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="n">func</span><span class="w"> </span><span class="n">not_spec</span><span class="p">(</span><span class="n">a</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">char</span> <span class="p">{</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>but not
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">func</span><span class="w"> </span><span class="n">spec</span><span class="p">[</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="p">](</span><span class="n">a</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">U</span><span class="p">;</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="n">func</span><span class="w"> </span><span class="n">spec</span><span class="p">(</span><span class="n">a</span>: <span class="nc">int</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">int</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="n">func</span><span class="w"> </span><span class="n">spec</span><span class="p">(</span><span class="n">a</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">char</span> <span class="p">{</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
</code></pre></div></p>
<p>This creates confusing errors for users and isn't a very good show of the language. We could make this good only by having extensive error messages with extremely good examples.</p>
<p>Or should we introduce a new function keyword to separate the original function and the specialization?</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">func</span><span class="w"> </span><span class="n">format</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">value</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="p">;</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="n">spec</span><span class="w"> </span><span class="n">format</span><span class="p">(</span><span class="n">s</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="n">func</span><span class="w"> </span><span class="n">map</span><span class="p">[</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="p">](</span><span class="n">value</span>: <span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="nc">func</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">U</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">U</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w">    </span><span class="n">f</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="p">}</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="n">spec</span><span class="w"> </span><span class="n">map</span><span class="p">[</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="p">](</span><span class="n">value</span>: <span class="nc">Maybe</span><span class="p">[</span><span class="n">T</span><span class="p">],</span><span class="w"> </span><span class="n">f</span>: <span class="nc">func</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">U</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Maybe</span><span class="p">[</span><span class="n">U</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="w">    </span><span class="n">switch</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="w">        </span><span class="n">contained</span>: <span class="nc">T</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">contained</span><span class="p">)</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="w">        </span><span class="n">Nothing</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Nothing</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="p">}</span>
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="n">spec</span><span class="w"> </span><span class="n">map</span><span class="p">[</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="p">](</span><span class="n">values</span>: <span class="nc">Vector</span><span class="p">[</span><span class="n">T</span><span class="p">],</span><span class="w"> </span><span class="n">f</span>: <span class="nc">func</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">U</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Vector</span><span class="p">[</span><span class="n">U</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="w">    </span><span class="n">values</span><span class="p">.</span><span class="n">fold</span><span class="p">(</span><span class="n">Vector</span>::<span class="n">new</span><span class="p">(),</span><span class="w"> </span><span class="o">|</span><span class="n">vec</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">|</span><span class="w"> </span><span class="n">vec</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">f</span><span class="p">)))</span>
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="p">}</span>
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a>
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a><span class="n">func</span><span class="w"> </span><span class="n">fold</span><span class="p">[</span><span class="n">In</span><span class="p">,</span><span class="w"> </span><span class="n">Out</span><span class="p">,</span><span class="w"> </span><span class="n">Elt</span><span class="p">](</span>
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a><span class="w">    </span><span class="n">values</span>: <span class="nc">In</span><span class="p">,</span>
<a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a><span class="w">    </span><span class="n">init</span>: <span class="nc">Out</span><span class="p">,</span>
<a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a><span class="w">    </span><span class="n">folder</span>: <span class="nc">func</span><span class="p">(</span><span class="n">Out</span><span class="p">,</span><span class="w"> </span><span class="n">Elt</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Out</span>
<a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Out</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a><span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">init</span><span class="p">;</span>
<a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">elt</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a><span class="w">        </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">folder</span><span class="p">(</span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">elt</span><span class="p">)</span>
<a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a>
<a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a><span class="w">    </span><span class="n">output</span>
<a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a><span class="p">}</span>
</code></pre></div>
<p>How to prevent overzealous specialization? For example, specializing <code>map</code> on <code>int</code> and <code>char</code> would not be great. Could it affect users of a library? Should we really disallow it?</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">func</span><span class="w"> </span><span class="n">format</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">value</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="p">;</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">func</span><span class="w"> </span><span class="n">format</span><span class="p">[</span><span class="n">T</span>: <span class="nc">string</span><span class="p">](</span><span class="n">value</span>: <span class="nc">string</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="n">func</span><span class="w"> </span><span class="n">format</span><span class="p">[</span><span class="n">T</span>: <span class="nc">int</span><span class="p">](</span><span class="n">value</span>: <span class="nc">int</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">int</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">format_int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="n">func</span><span class="w"> </span><span class="n">format</span><span class="p">[</span><span class="n">T</span>: <span class="kt">bool</span><span class="p">](</span><span class="n">value</span>: <span class="kt">bool</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">int</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">    </span><span class="n">switch</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">        </span><span class="kc">true</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="p">,</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">        </span><span class="kc">false</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="p">,</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="p">}</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="n">func</span><span class="w"> </span><span class="n">map</span><span class="p">[</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="p">](</span><span class="n">value</span>: <span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="nc">func</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">U</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">U</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="w">    </span><span class="n">f</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="p">}</span>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="c1">// isn&#39;t this a bit confusing...</span>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="n">func</span><span class="w"> </span><span class="n">map</span><span class="p">[</span><span class="n">I</span><span class="p">,</span><span class="w"> </span><span class="n">O</span><span class="p">,</span><span class="w"> </span><span class="n">T</span>: <span class="nc">Maybe</span><span class="p">[</span><span class="n">I</span><span class="p">],</span><span class="w"> </span><span class="n">U</span>: <span class="nc">Maybe</span><span class="p">[</span><span class="n">O</span><span class="p">]](</span><span class="n">value</span>: <span class="nc">Maybe</span><span class="p">[</span><span class="n">I</span><span class="p">],</span><span class="w"> </span><span class="n">f</span>: <span class="nc">func</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">O</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Maybe</span><span class="p">[</span><span class="n">O</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a><span class="w">    </span><span class="n">switch</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="w">        </span><span class="n">input</span>: <span class="nc">I</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">input</span><span class="p">),</span>
<a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a><span class="w">        </span><span class="n">Nothing</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Nothing</span><span class="p">,</span>
<a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a><span class="p">}</span>
<a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a>
<a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a><span class="c1">// should we go for this instead? yes</span>
<a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a><span class="n">func</span><span class="w"> </span><span class="n">map</span><span class="p">[</span><span class="n">I</span><span class="p">,</span><span class="w"> </span><span class="n">O</span><span class="p">][</span><span class="n">T</span>: <span class="nc">Maybe</span><span class="p">[</span><span class="n">I</span><span class="p">],</span><span class="w"> </span><span class="n">U</span>: <span class="nc">Maybe</span><span class="p">[</span><span class="n">O</span><span class="p">]](</span><span class="n">value</span>: <span class="nc">Maybe</span><span class="p">[</span><span class="n">I</span><span class="p">],</span><span class="w"> </span><span class="n">f</span>: <span class="nc">func</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">O</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Maybe</span><span class="p">[</span><span class="n">O</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* ... */</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a><span class="n">func</span><span class="w"> </span><span class="n">map</span><span class="p">[</span><span class="n">I</span><span class="p">,</span><span class="w"> </span><span class="n">O</span><span class="p">](</span><span class="n">T</span>: <span class="nc">Vector</span><span class="p">[</span><span class="n">I</span><span class="p">],</span><span class="w"> </span><span class="n">U</span>: <span class="nc">Vector</span><span class="p">[</span><span class="n">O</span><span class="p">])(</span>
<a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a><span class="w">    </span><span class="n">values</span>: <span class="nc">Vector</span><span class="p">[</span><span class="n">I</span><span class="p">],</span>
<a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a><span class="w">    </span><span class="n">f</span>: <span class="nc">func</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">O</span>
<a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Vector</span><span class="p">[</span><span class="n">O</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a><span class="w">    </span><span class="n">values</span><span class="p">.</span><span class="n">fold</span><span class="p">(</span><span class="n">Vector</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">vec</span><span class="p">,</span><span class="w"> </span><span class="n">elt</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">vec</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">elt</span><span class="p">)))</span>
<a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a><span class="p">}</span>
<a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a>
<a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a><span class="n">func</span><span class="w"> </span><span class="n">fold</span><span class="p">[</span><span class="n">In</span><span class="p">,</span><span class="w"> </span><span class="n">Out</span><span class="p">,</span><span class="w"> </span><span class="n">Elt</span><span class="p">](</span>
<a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a><span class="w">    </span><span class="n">values</span>: <span class="nc">In</span><span class="p">,</span>
<a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a><span class="w">    </span><span class="n">init</span>: <span class="nc">Out</span><span class="p">,</span>
<a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a><span class="w">    </span><span class="n">folder</span>: <span class="nc">func</span><span class="p">(</span><span class="n">Out</span><span class="p">,</span><span class="w"> </span><span class="n">Elt</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Out</span><span class="p">,</span>
<a id="__codelineno-23-36" name="__codelineno-23-36" href="#__codelineno-23-36"></a><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Out</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-37" name="__codelineno-23-37" href="#__codelineno-23-37"></a><span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">init</span><span class="p">;</span>
<a id="__codelineno-23-38" name="__codelineno-23-38" href="#__codelineno-23-38"></a><span class="w">    </span><span class="n">values</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">for_each</span><span class="p">(</span><span class="n">elt</span><span class="w"> </span>-&gt; <span class="p">{</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">folder</span><span class="p">(</span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">elt</span><span class="p">)</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-23-39" name="__codelineno-23-39" href="#__codelineno-23-39"></a>
<a id="__codelineno-23-40" name="__codelineno-23-40" href="#__codelineno-23-40"></a><span class="w">    </span><span class="n">output</span>
<a id="__codelineno-23-41" name="__codelineno-23-41" href="#__codelineno-23-41"></a><span class="p">}</span>
</code></pre></div>
<h2 id="specializing-functions-only-in-the-current-context">Specializing functions only in the current context</h2>
<p>Specialization should only be possible for functions which live in the current namespace/are refered to by their full names. This will avoid a lot of complications with name conflicts, and user defined methods with similar names as library/core ones.</p>
<p>Let's take the example of the <code>fmt</code> function, defined in <code>core</code> as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">func</span><span class="w"> </span><span class="n">fmt</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">value</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* ... */</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>Now let's specialize it for our custom type <code>Foo</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="k">type</span> <span class="nc">Foo</span><span class="p">;</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="n">func</span><span class="w"> </span><span class="n">fmt</span><span class="p">[</span><span class="n">T</span>: <span class="nc">Foo</span><span class="p">](</span><span class="n">f</span>: <span class="nc">Foo</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Foo&quot;</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>This should error out, because we are specializing a function whose generic definition does not exist - the generic <code>fmt</code> is not present in the current namespace/definition pool.</p>
<p>We can circumvent that by using its full name, or importing <code>fmt</code> into the definition pool:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="k">type</span> <span class="nc">Foo</span><span class="p">;</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="n">func</span><span class="w"> </span><span class="n">core</span><span class="p">.</span><span class="n">fmt</span><span class="p">[</span><span class="n">T</span>: <span class="nc">Foo</span><span class="p">](</span><span class="n">f</span>: <span class="nc">Foo</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Foo&quot;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="c1">// or</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="k">where</span><span class="w"> </span><span class="n">fmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">core</span><span class="p">.</span><span class="n">fmt</span><span class="p">;</span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="k">type</span> <span class="nc">Foo</span><span class="p">;</span>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a><span class="n">func</span><span class="w"> </span><span class="n">fmt</span><span class="p">[</span><span class="n">T</span>: <span class="nc">Foo</span><span class="p">](</span><span class="n">f</span>: <span class="nc">Foo</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Foo&quot;</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>NOTE: How to output that error? Super confusing if the user just expects <code>fmt</code> to exist to see something like <code>fmt does not exist</code>.</p>
<h2 id="specialization-as-pattern-matching-extension">Specialization as pattern matching extension?</h2>
<p>Specialization can be thought of as adding a new case to a generic pattern, e.g.:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">func</span><span class="w"> </span><span class="n">fmt</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">x</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="w">    </span><span class="n">jinko</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;unimplemented function `fmt` for type `{any_type}`&quot;</span><span class="p">)</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="p">}</span>
</code></pre></div>
<p>is almost the same as:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="k">where</span><span class="w"> </span><span class="n">fmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span>-&gt; <span class="nc">switch</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">    </span><span class="n">any_type</span>: <span class="nc">_</span><span class="w"> </span>-&gt; <span class="nc">jinko</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;unimplemented function `fmt` for type `{any_type}`&quot;</span><span class="p">),</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="p">}</span>
</code></pre></div>
<p>So if we had a syntax for "extending" that pattern with new cases/match arms, then it could make sense:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1">// add an implementation of `fmt` for strings</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="n">fmt</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">s</span>: <span class="nc">string</span><span class="w"> </span>-&gt; <span class="nc">s</span><span class="p">;</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="c1">// for ints and chars</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="n">fmt</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">i</span>: <span class="nc">int</span><span class="w"> </span>-&gt; <span class="nc">core</span><span class="p">.</span><span class="n">int</span><span class="p">.</span><span class="n">int_to_str</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="n">fmt</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">c</span>: <span class="kt">char</span> -&gt; <span class="nc">core</span><span class="p">.</span><span class="n">string</span><span class="p">.</span><span class="n">string_from_char</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="c1">// for a custom type</span>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="n">fmt</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">f</span>: <span class="nc">Foo</span><span class="w"> </span>-&gt; <span class="s">&quot;Foo&quot;</span><span class="p">;</span>
</code></pre></div>
<p>But how to have a syntax that makes sense here?</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">func</span><span class="w"> </span><span class="n">fmt</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">value</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">string</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="w">    </span><span class="n">jinko</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;unimplemented function `fmt` for type `{any_type}`&quot;</span><span class="p">)</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="p">}</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="n">fmt</span><span class="w"> </span>:: <span class="nc">i</span>: <span class="nc">int</span><span class="w"> </span>-&gt; <span class="nc">core</span><span class="p">.</span><span class="n">int</span><span class="p">.</span><span class="n">int_to_str</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="n">fmt</span><span class="w"> </span>:: <span class="nc">s</span>: <span class="nc">string</span><span class="w"> </span>-&gt; <span class="nc">s</span><span class="p">;</span>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="n">fmt</span><span class="w"> </span>:: <span class="nc">Foo</span><span class="w"> </span>-&gt; <span class="s">&quot;Foo&quot;</span><span class="p">;</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.dd8806f2.min.js"></script>
      
    
  </body>
</html>